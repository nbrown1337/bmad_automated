---
phase: 10-update-queue-command
plan: 01
type: tdd
---

<objective>
Update queue command to use lifecycle executor for full story lifecycle per story.

Purpose: Queue command should execute complete lifecycle (create->dev->review->commit) for each story before moving to the next, consistent with run and epic commands.
Output: Queue command with lifecycle execution, comprehensive tests, and updated help text.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Auto-selected based on dependency graph:

@.planning/phases/07-story-lifecycle-executor/07-02-SUMMARY.md
@.planning/phases/08-update-run-command/08-01-SUMMARY.md
@.planning/phases/09-update-epic-command/09-01-SUMMARY.md

# Key files:

@internal/cli/queue.go
@internal/cli/queue_test.go
@internal/cli/epic.go
@internal/cli/root.go
@internal/lifecycle/executor.go

**Tech stack available:** lifecycle.Executor, lifecycle.NewExecutor, interfaces (WorkflowRunner, StatusReader, StatusWriter)
**Established patterns:** lifecycle.Executor usage in CLI commands, table-driven TDD tests with mocks
**Constraining decisions:**

- Phase 8: Interface-based DI in App struct (WorkflowRunner, StatusReader, StatusWriter)
- Phase 9: Epic command pattern for lifecycle execution

**Issues being addressed:** None
</context>

<feature>
  <name>Queue command with lifecycle execution</name>
  <files>internal/cli/queue.go, internal/cli/queue_test.go</files>
  <behavior>
    Queue command uses lifecycle.Executor instead of QueueRunner.RunQueueWithStatus.

    For each story in args:
    1. Execute full lifecycle via lifecycle.Executor.Execute()
    2. Handle router.ErrStoryComplete for done stories (skip, print message)
    3. Fail-fast on workflow failure
    4. Print success message after each story completes
    5. Print summary at end

    Cases:
    - 2 backlog stories -> 8 workflows total (4 per story), both complete
    - Mixed statuses (backlog, ready-for-dev, review) -> varying workflows per story
    - Done story in queue -> skipped, no error
    - Workflow failure -> fail-fast, return exit code 1
    - All done stories -> all skipped, success

  </behavior>
  <implementation>
    Follow epic.go pattern exactly:
    1. Create lifecycle executor: lifecycle.NewExecutor(app.Runner, app.StatusReader, app.StatusWriter)
    2. For each storyKey in args:
       - Call executor.Execute(ctx, storyKey)
       - If err == router.ErrStoryComplete: print skip message, continue
       - If err != nil: print error, return NewExitError(1)
       - Print success message
    3. Print total stories processed
    4. Return nil

    Update help text to describe full lifecycle behavior (copy from epic.go, adapt for queue).

    Remove app.Queue field usage - queue command no longer needs QueueRunner.

  </implementation>
</feature>

<verification>
go test ./internal/cli/... -run TestQueue -v
go build ./...
</verification>

<success_criteria>

- Failing tests written and committed (RED)
- Implementation passes all tests (GREEN)
- Refactor if needed (REFACTOR)
- All existing queue behaviors maintained: done skip, fail-fast
- Help text updated to describe lifecycle behavior
- 2-3 commits produced
  </success_criteria>

<output>
After completion, create `.planning/phases/10-update-queue-command/10-01-SUMMARY.md`:

# Phase 10 Plan 01: Queue Command with Lifecycle Execution Summary

**[One-liner describing what shipped]**

## Performance

- **Duration:** X min
- **Started:** timestamp
- **Completed:** timestamp
- **TDD Phases:** RED, GREEN[, REFACTOR]
- **Files modified:** N

## TDD Cycle

### RED Phase

[What tests were written, why they failed]

### GREEN Phase

[What implementation made them pass]

### REFACTOR Phase

[What cleanup was done, or "No refactoring needed"]

## Task Commits

1. **RED: Failing tests** - commit_hash (test)
2. **GREEN: Implementation** - commit_hash (feat)
   [3. **REFACTOR: Cleanup** - commit_hash (refactor)]

## Files Created/Modified

- `internal/cli/queue.go` - Description
- `internal/cli/queue_test.go` - Description

## Decisions Made

[Key decisions and rationale]

## Deviations from Plan

[Any deviations, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[What's ready for Phase 11: Error Recovery & Resume]

---

_Phase: 10-update-queue-command_
_Completed: YYYY-MM-DD_
</output>
