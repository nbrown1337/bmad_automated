# Milestone v1.0: Status-Based Workflow Routing

**Status:** ✅ SHIPPED 2026-01-08
**Phases:** 1-5
**Total Plans:** 5

## Overview

Transform BMAD Automate from manual workflow selection to automatic status-based routing. The CLI reads story status from sprint-status.yaml and automatically selects the correct workflow (create-story, dev-story, or code-review). Culminates in a new `epic` command for batch execution.

## Phases

### Phase 1: Sprint Status Reader

**Goal**: Create a package that reads `_bmad-output/implementation-artifacts/sprint-status.yaml` and returns story status by key
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:

- [x] 01-01: Sprint Status Types and Reader

**Details:**

- Created `internal/status` package with Status type (5 constants + IsValid())
- SprintStatus struct for YAML mapping
- Reader with Read() and GetStoryStatus() methods
- Comprehensive test coverage (10 tests)

### Phase 2: Workflow Router

**Goal**: Create routing logic that maps status values to workflow names
**Depends on**: Phase 1
**Plans**: 1 plan

Plans:

- [x] 02-01: Status to Workflow Router (TDD)

**Details:**

- GetWorkflow function with switch-statement routing
- Sentinel errors: ErrStoryComplete, ErrUnknownStatus
- Full test coverage (10 tests)
- Mapping: backlog→create-story, ready-for-dev/in-progress→dev-story, review→code-review

### Phase 3: Update Run Command

**Goal**: Modify `run` command to use status-based routing instead of explicit workflow flag
**Depends on**: Phase 2
**Plans**: 1 plan

Plans:

- [x] 03-01: Update Run Command with Status-Based Routing

**Details:**

- StatusReader injected via App struct for testability
- Run command reads sprint-status.yaml and routes automatically
- Done stories return success with message (not error)
- Updated command description

### Phase 4: Update Queue Command

**Goal**: Modify `queue` command to use status-based routing for each story
**Depends on**: Phase 3
**Plans**: 1 plan

Plans:

- [x] 04-01: Update Queue Command with Status-Based Routing

**Details:**

- Queue routes each story based on status
- Done stories skipped (not failures) - allows mixed-status batches
- Queue summary shows skipped count
- Fail-fast on first error

### Phase 5: Epic Command

**Goal**: New `bmad-automate epic <epic-id>` command that runs all non-done stories in numeric order, stopping on first failure
**Depends on**: Phase 4
**Plans**: 1 plan

Plans:

- [x] 05-01: Epic Command Implementation

**Details:**

- GetEpicStories method filters by prefix, sorts numerically
- Epic command reuses QueueRunner (inherits all routing and skip behavior)
- Story keys parsed as {epicID}-{N}-{description}

---

## Milestone Summary

**Decimal Phases:**

None - all phases were integer phases as originally planned.

**Key Decisions:**

- Used direct yaml.v3 instead of Viper for sprint-status.yaml (simpler for single file)
- Package-level function for router (pure mapping, no state)
- StatusReader injected via App struct for testability
- Done stories in queue skipped (continue), not terminal success
- Epic command reuses QueueRunner (inherits all behavior)

**Issues Resolved:**

None - all plans executed without issues.

**Issues Deferred:**

None

**Technical Debt Incurred:**

None

---

_For current project status, see .planning/ROADMAP.md_
